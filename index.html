<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘å¥å¡ç‰‡ç”Ÿæˆå™¨ - Created by å¿ƒé“</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            font-family: 'Noto Serif SC', serif;
            color: #fff;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            text-align: center;
            margin-bottom: 50px;
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #f5af19 0%, #f12711 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.7;
        }

        .input-section {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 50px;
            flex-wrap: wrap;
        }

        .input-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        input[type="text"] {
            padding: 16px 24px;
            font-size: 18px;
            font-family: 'Noto Serif SC', serif;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            width: 300px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        input[type="text"]::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #f5af19;
            box-shadow: 0 0 30px rgba(245, 175, 25, 0.3);
        }

        .btn {
            padding: 16px 40px;
            font-size: 18px;
            font-weight: 600;
            font-family: 'Noto Serif SC', serif;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #f5af19 0%, #f12711 100%);
            color: #fff;
            box-shadow: 0 10px 30px rgba(241, 39, 17, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(241, 39, 17, 0.5);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-download {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .btn-download:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.5);
        }

        .card-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        #svg-wrapper {
            border-radius: 24px;
            box-shadow: 0 30px 100px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            display: none;
        }

        .loading {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 60px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #f5af19;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            font-size: 1.2rem;
            opacity: 0.8;
        }

        .action-buttons {
            display: none;
            gap: 16px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .api-key-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .api-key-section label {
            display: block;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        .api-key-section input {
            width: 100%;
            max-width: 500px;
        }

        .api-key-section a {
            color: #f5af19;
            text-decoration: none;
        }

        .api-key-section a:hover {
            text-decoration: underline;
        }

        footer {
            text-align: center;
            margin-top: 60px;
            padding: 20px;
            opacity: 0.6;
        }

        canvas {
            display: none;
        }

        .error-message {
            background: rgba(255, 59, 48, 0.2);
            border: 1px solid rgba(255, 59, 48, 0.5);
            border-radius: 12px;
            padding: 16px 24px;
            margin: 20px 0;
            display: none;
        }

        /* é¢„è®¾ä¸»é¢˜è‰² */
        .theme-presets {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }

        .theme-chip {
            padding: 8px 16px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .theme-chip:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>ğŸ“š é‡‘å¥å¡ç‰‡ç”Ÿæˆå™¨</h1>
            <p class="subtitle">è¾“å…¥ä¹¦åï¼ŒAI ä¸ºæ‚¨ç”Ÿæˆç²¾ç¾çš„é‡‘å¥å¡ç‰‡</p>
        </header>

        <div class="api-key-section">
            <label>ğŸ”‘ Gemini API Keyï¼ˆ<a href="https://aistudio.google.com/apikey" target="_blank">ç‚¹å‡»è·å–</a>ï¼‰</label>
            <input type="text" id="apiKey" placeholder="è¯·è¾“å…¥æ‚¨çš„ Gemini API Key" />
        </div>

        <div class="input-section">
            <div class="input-group">
                <input type="text" id="bookName" placeholder="è¯·è¾“å…¥ä¹¦åï¼Œå¦‚ï¼šæ´»ç€" />
                <button class="btn btn-primary" id="generateBtn" onclick="generateCard()">
                    âœ¨ ç”Ÿæˆå¡ç‰‡
                </button>
            </div>
        </div>

        <div class="theme-presets">
            <span class="theme-chip" onclick="setBook('æ´»ç€')">æ´»ç€</span>
            <span class="theme-chip" onclick="setBook('ç™¾å¹´å­¤ç‹¬')">ç™¾å¹´å­¤ç‹¬</span>
            <span class="theme-chip" onclick="setBook('å°ç‹å­')">å°ç‹å­</span>
            <span class="theme-chip" onclick="setBook('å›´åŸ')">å›´åŸ</span>
            <span class="theme-chip" onclick="setBook('çº¢æ¥¼æ¢¦')">çº¢æ¥¼æ¢¦</span>
            <span class="theme-chip" onclick="setBook('æˆ˜äº‰ä¸å’Œå¹³')">æˆ˜äº‰ä¸å’Œå¹³</span>
        </div>

        <div class="error-message" id="errorMessage"></div>

        <div class="card-container">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p class="loading-text">AI æ­£åœ¨ä¸ºæ‚¨åˆ›ä½œé‡‘å¥å¡ç‰‡...</p>
            </div>

            <div id="svg-wrapper"></div>

            <div class="action-buttons" id="actionButtons">
                <button class="btn btn-download" onclick="downloadAsPNG()">
                    ğŸ“¥ ä¸‹è½½ PNG å›¾ç‰‡
                </button>
                <button class="btn btn-primary" onclick="generateCard()">
                    ğŸ”„ é‡æ–°ç”Ÿæˆ
                </button>
            </div>
        </div>

        <footer>
            <p>Created by å¿ƒé“ | Powered by Gemini AI</p>
        </footer>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        // ä¸»é¢˜é…è‰²æ–¹æ¡ˆ
        const themeColors = {
            'è‹¦éš¾': { colors: ['#3D2914', '#5D4E37', '#6B7B8C', '#87969B'], accent: '#DAA520' },
            'çˆ±æƒ…': { colors: ['#2C3E50', '#E84393', '#FF7F50', '#FFD700'], accent: '#FF69B4' },
            'æˆ˜äº‰': { colors: ['#1a1a2e', '#4a1942', '#c44b6c', '#ff6b6b'], accent: '#FFD700' },
            'å’Œå¹³': { colors: ['#0d1b2a', '#1b263b', '#415a77', '#778da9'], accent: '#87CEEB' },
            'å­¤ç‹¬': { colors: ['#0f0f23', '#1a1a3e', '#2d2d5a', '#4a4a7a'], accent: '#9370DB' },
            'ç«¥è¯': { colors: ['#1a1a40', '#3d2c8d', '#5c4d91', '#8b7dc3'], accent: '#FFD700' },
            'å“²ç†': { colors: ['#0d1b2a', '#1b263b', '#2d4a3e', '#3d6a5a'], accent: '#98FB98' },
            'å†å²': { colors: ['#2c1810', '#4a2c1a', '#6b4423', '#8b5a2b'], accent: '#CD853F' },
            'é»˜è®¤': { colors: ['#1a1a2e', '#302b63', '#483d8b', '#6a5acd'], accent: '#FFD700' }
        };

        // å›¾å½¢æ¨¡æ¿
        const graphicTemplates = {
            'éº¦ç©—': `<symbol id="theme-graphic" viewBox="0 0 40 100">
                <path d="M20,100 L20,30" stroke="url(#accent-gradient)" stroke-width="2" fill="none"/>
                <ellipse cx="20" cy="25" rx="4" ry="10" fill="url(#accent-gradient)"/>
                <ellipse cx="12" cy="35" rx="4" ry="8" fill="url(#accent-gradient)" transform="rotate(-20 12 35)"/>
                <ellipse cx="28" cy="35" rx="4" ry="8" fill="url(#accent-gradient)" transform="rotate(20 28 35)"/>
                <ellipse cx="10" cy="50" rx="3" ry="7" fill="url(#accent-gradient)" transform="rotate(-25 10 50)"/>
                <ellipse cx="30" cy="50" rx="3" ry="7" fill="url(#accent-gradient)" transform="rotate(25 30 50)"/>
            </symbol>`,
            'å¿ƒå½¢': `<symbol id="theme-graphic" viewBox="-15 -15 30 30">
                <path d="M0,-5 C-5,-10 -10,-5 -10,0 C-10,5 0,10 0,10 C0,10 10,5 10,0 C10,-5 5,-10 0,-5" 
                      fill="url(#accent-gradient)" opacity="0.6"/>
            </symbol>`,
            'æ˜Ÿæ˜Ÿ': `<symbol id="theme-graphic" viewBox="0 0 50 50">
                <path d="M25,0 L30,20 L50,25 L30,30 L25,50 L20,30 L0,25 L20,20 Z" 
                      fill="url(#accent-gradient)" opacity="0.5"/>
            </symbol>`,
            'è²èŠ±': `<symbol id="theme-graphic" viewBox="-30 -30 60 60">
                <ellipse cx="0" cy="0" rx="8" ry="20" fill="url(#accent-gradient)" opacity="0.6"/>
                <ellipse cx="0" cy="0" rx="8" ry="20" fill="url(#accent-gradient)" opacity="0.5" transform="rotate(36)"/>
                <ellipse cx="0" cy="0" rx="8" ry="20" fill="url(#accent-gradient)" opacity="0.4" transform="rotate(72)"/>
                <ellipse cx="0" cy="0" rx="8" ry="20" fill="url(#accent-gradient)" opacity="0.5" transform="rotate(108)"/>
                <ellipse cx="0" cy="0" rx="8" ry="20" fill="url(#accent-gradient)" opacity="0.6" transform="rotate(144)"/>
            </symbol>`,
            'ä¹¦æœ¬': `<symbol id="theme-graphic" viewBox="0 0 60 50">
                <path d="M30,10 L5,15 L5,45 L30,40 L55,45 L55,15 Z" 
                      fill="none" stroke="url(#accent-gradient)" stroke-width="2" opacity="0.5"/>
                <path d="M30,10 L30,40" stroke="url(#accent-gradient)" stroke-width="1" opacity="0.5"/>
            </symbol>`
        };

        function setBook(name) {
            document.getElementById('bookName').value = name;
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            setTimeout(() => errorEl.style.display = 'none', 5000);
        }

        async function generateCard() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const bookName = document.getElementById('bookName').value.trim();

            if (!apiKey) {
                showError('è¯·è¾“å…¥ Gemini API Key');
                return;
            }

            if (!bookName) {
                showError('è¯·è¾“å…¥ä¹¦å');
                return;
            }

            const generateBtn = document.getElementById('generateBtn');
            const loading = document.getElementById('loading');
            const svgWrapper = document.getElementById('svg-wrapper');
            const actionButtons = document.getElementById('actionButtons');

            generateBtn.disabled = true;
            loading.style.display = 'flex';
            svgWrapper.style.display = 'none';
            actionButtons.style.display = 'none';

            try {
                const prompt = `ä½ æ˜¯ä¸€ä½æ–‡å­¦é‡‘å¥æå–ä¸“å®¶ã€‚è¯·æ ¹æ®ä¹¦åã€Š${bookName}ã€‹ï¼Œæå–ä¸€å¥æœ€å…·ä»£è¡¨æ€§çš„é‡‘å¥ï¼Œå¹¶è¿”å›ä»¥ä¸‹ JSON æ ¼å¼ï¼ˆä¸è¦åŒ…å« markdown ä»£ç å—æ ‡è®°ï¼‰ï¼š

{
    "quote": "é‡‘å¥å†…å®¹ï¼ˆ15-40å­—ï¼Œå¯ä»¥åˆ†æˆ2-3ä¸ªçŸ­å¥ï¼‰",
    "keyword": "é‡‘å¥ä¸­æœ€æ ¸å¿ƒçš„1-2ä¸ªè¯",
    "author": "ä½œè€…å",
    "theme": "ä¸»é¢˜ç±»å‹ï¼ˆä»ä»¥ä¸‹é€‰æ‹©ä¸€ä¸ªï¼šè‹¦éš¾/çˆ±æƒ…/æˆ˜äº‰/å’Œå¹³/å­¤ç‹¬/ç«¥è¯/å“²ç†/å†å²ï¼‰",
    "graphic": "è£…é¥°å›¾å½¢ï¼ˆä»ä»¥ä¸‹é€‰æ‹©ä¸€ä¸ªï¼šéº¦ç©—/å¿ƒå½¢/æ˜Ÿæ˜Ÿ/è²èŠ±/ä¹¦æœ¬ï¼‰",
    "lines": ["ç¬¬ä¸€è¡Œæ–‡å­—", "ç¬¬äºŒè¡Œæ–‡å­—", "ç¬¬ä¸‰è¡Œæ–‡å­—ï¼ˆå¯é€‰ï¼‰"]
}

æ³¨æ„ï¼š
1. é‡‘å¥è¦æœ‰æ·±åº¦å’Œç¾æ„Ÿ
2. lines æ•°ç»„ä¸­ï¼ŒåŒ…å«å…³é”®è¯çš„é‚£ä¸€è¡Œï¼Œå…³é”®è¯å‰ååˆ†å¼€ï¼Œæ–¹ä¾¿åç»­æ ‡è®°
3. æ¯è¡Œæ§åˆ¶åœ¨ 12 å­—ä»¥å†…
4. åªè¿”å› JSONï¼Œä¸è¦å…¶ä»–å†…å®¹`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { temperature: 0.8 }
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    const errMsg = data.error?.message || JSON.stringify(data);
                    console.error('API Error:', data);
                    throw new Error(`APIé”™è¯¯: ${errMsg}`);
                }

                if (!data.candidates || !data.candidates[0]?.content?.parts?.[0]?.text) {
                    console.error('Unexpected response:', data);
                    throw new Error('APIè¿”å›æ ¼å¼å¼‚å¸¸ï¼Œè¯·é‡è¯•');
                }

                let text = data.candidates[0].content.parts[0].text;

                // æ¸…ç† markdown ä»£ç å—æ ‡è®°
                text = text.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();

                const result = JSON.parse(text);
                renderCard(bookName, result);

            } catch (error) {
                console.error(error);
                showError('ç”Ÿæˆå¤±è´¥ï¼š' + error.message);
            } finally {
                generateBtn.disabled = false;
                loading.style.display = 'none';
            }
        }

        function renderCard(bookName, data) {
            const theme = themeColors[data.theme] || themeColors['é»˜è®¤'];
            const graphic = graphicTemplates[data.graphic] || graphicTemplates['æ˜Ÿæ˜Ÿ'];

            // å¤„ç†æ–‡å­—è¡Œï¼Œæ ‡è®°å…³é”®è¯
            const lines = data.lines.map(line => {
                if (line.includes(data.keyword)) {
                    return line.replace(data.keyword, `<tspan font-size="69">${data.keyword}</tspan>`);
                }
                return line;
            });

            const svg = `
            <svg id="quote-card" width="800" height="800" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <style type="text/css">
                        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&display=swap');
                        text { font-family: 'Noto Serif SC', serif; }
                    </style>

                    <linearGradient id="bg-gradient" x1="0%" y1="100%" x2="0%" y2="0%">
                        <stop offset="0%" style="stop-color:${theme.colors[0]}"/>
                        <stop offset="40%" style="stop-color:${theme.colors[1]}"/>
                        <stop offset="70%" style="stop-color:${theme.colors[2]}"/>
                        <stop offset="100%" style="stop-color:${theme.colors[3]}"/>
                    </linearGradient>

                    <linearGradient id="accent-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:${theme.accent}"/>
                        <stop offset="100%" style="stop-color:${theme.accent}; stop-opacity:0.6"/>
                    </linearGradient>

                    <filter id="text-glow">
                        <feGaussianBlur in="SourceGraphic" stdDeviation="2"/>
                        <feComponentTransfer>
                            <feFuncA type="linear" slope="0.3"/>
                        </feComponentTransfer>
                        <feMerge>
                            <feMergeNode/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>

                    ${graphic}
                </defs>

                <!-- å¡ç‰‡é˜´å½± -->
                <rect x="120" y="120" width="600" height="600" rx="20" 
                      fill="#000" opacity="0.5" filter="blur(15px)"/>

                <!-- èƒŒæ™¯å¡ç‰‡ -->
                <rect x="80" y="80" width="600" height="600" rx="20" 
                      fill="url(#bg-gradient)"/>

                <!-- è£…é¥°å›¾å½¢ -->
                <use href="#theme-graphic" x="160" y="340" width="50" height="100" opacity="0.3"/>
                <use href="#theme-graphic" x="560" y="360" width="45" height="90" opacity="0.25"/>

                <!-- é‡‘å¥æ–‡å­— -->
                ${lines.map((line, i) => `
                <text x="380" y="${220 + i * 80}" text-anchor="middle" fill="#FFFFFF" 
                      font-size="42" filter="url(#text-glow)">${line}</text>
                `).join('')}

                <!-- è£…é¥°çº¿ -->
                <path d="M250 520 L550 520" stroke="${theme.accent}" 
                      stroke-width="1" stroke-dasharray="5,5" opacity="0.5"/>

                <!-- ä¹¦å -->
                <text x="380" y="560" text-anchor="middle" fill="#FFFFFF" 
                      font-size="24" filter="url(#text-glow)">â€”â€”ã€Š${bookName}ã€‹</text>

                <!-- ä½œè€… -->
                <text x="380" y="595" text-anchor="middle" fill="#FFFFFF" 
                      font-size="20" filter="url(#text-glow)">${data.author}</text>

                <!-- ç½²å -->
                <text x="380" y="630" text-anchor="middle" fill="#FFFFFF" 
                      font-size="16" opacity="0.8">Created by å¿ƒé“</text>
            </svg>`;

            document.getElementById('svg-wrapper').innerHTML = svg;
            document.getElementById('svg-wrapper').style.display = 'block';
            document.getElementById('actionButtons').style.display = 'flex';
        }

        function downloadAsPNG() {
            const svg = document.getElementById('quote-card');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');

            const scale = 2;
            canvas.width = 800 * scale;
            canvas.height = 800 * scale;
            ctx.scale(scale, scale);

            const svgData = new XMLSerializer().serializeToString(svg);
            const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
            const url = URL.createObjectURL(svgBlob);

            const img = new Image();
            img.onload = function () {
                ctx.drawImage(img, 0, 0);
                URL.revokeObjectURL(url);

                const pngUrl = canvas.toDataURL('image/png');
                const downloadLink = document.createElement('a');
                downloadLink.href = pngUrl;

                const bookName = document.getElementById('bookName').value.trim();
                downloadLink.download = `é‡‘å¥å¡ç‰‡_${bookName}.png`;

                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
            };
            img.src = url;
        }

        // å›è½¦é”®è§¦å‘ç”Ÿæˆ
        document.getElementById('bookName').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                generateCard();
            }
        });
    </script>
</body>

</html>